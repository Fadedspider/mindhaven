<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MindHeaven</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(to top left, #e0eafc, #cfdef3);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #2e3d49;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 40px 20px;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #3b3b3b;
        }

        p {
            margin: 10px 0;
            font-size: 1.1rem;
        }

        #serenAnimation {
            width: 300px;
            max-width: 90%;
            border-radius: 15px;
            margin: 20px 0;
        }

        .input-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        input[type="text"] {
            padding: 10px;
            width: 280px;
            max-width: 90%;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
        }

        .btn {
            background-color: #6b9ac4;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background-color: #507dac;
        }

        #responseAudio {
            margin-top: 15px;
        }

        .mood-display {
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 10px;
        }

        a {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #507dac;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            text-decoration: none;
        }

        a:hover {
            background: #345c8c;
        }
    </style>
</head>
<body>

    <a href="/interactions">History</a>

    <h1>MindHeaven</h1>
    <p>Your calm space to share thoughts and feel heard üí¨</p>

    <img id="serenAnimation" src="/static/seren_calm.gif" alt="Seren Animation">
    
    <div class="input-section">
        <p>üé§ Talk to Seren</p>
        <button class="btn" onclick="startRecording()">Start Recording</button>
        <button class="btn" id="stopButton" onclick="stopRecording()" style="display: none;">Stop Recording</button>

        <p>‚å®Ô∏è Or type how you're feeling</p>
        <input type="text" id="textInput" placeholder="Type your feelings...">
        <button class="btn" onclick="sendText()">Submit</button>
    </div>

    <div class="mood-display" id="moodDisplay">Detected Mood: </div>
    <p id="responseDisplay"></p>
    <audio id="responseAudio" controls></audio>

    <script>
        let mediaRecorder;
        let audioChunks = [];

        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: mediaRecorder.mimeType });
                        sendAudio(audioBlob);
                    };
                    audioChunks = [];
                    mediaRecorder.start();
                    document.getElementById('stopButton').style.display = 'inline-block';
                })
                .catch(error => console.error('Microphone error:', error));
        }

        function stopRecording() {
            mediaRecorder.stop();
            document.getElementById('stopButton').style.display = 'none';
        }

        function sendAudio(audioBlob) {
            const formData = new FormData();
            formData.append('audio', audioBlob, 'recording.webm');
            fetch('/process_audio', {
                method: 'POST',
                body: formData
            })
            .then(res => res.json())
            .then(data => updateUI(data))
            .catch(err => console.error('Audio error:', err));
        }

        function sendText() {
            const text = document.getElementById('textInput').value;
            fetch('/process_audio', {
                method: 'POST',
                body: JSON.stringify({ text: text }),
                headers: { 'Content-Type': 'application/json' }
            })
            .then(res => res.json())
            .then(data => updateUI(data))
            .catch(err => console.error('Text error:', err));
        }

        function updateUI(data) {
            document.getElementById('moodDisplay').innerText = `Detected Mood: ${data.mood}`;
            document.getElementById('responseDisplay').innerText = data.response;
            document.getElementById('responseAudio').src = data.audio;
            updateSerenAnimation(data.mood);
        }

        function updateSerenAnimation(mood) {
            const seren = document.getElementById('serenAnimation');
            switch (mood) {
                case "stress":
                case "sadness":
                    seren.src = "/static/seren_sad.gif";
                    break;
                case "neutral":
                    seren.src = "/static/seren_calm.gif";
                    break;
                case "thinking":
                    seren.src = "/static/seren_thinking.gif";
                    break;
                case "comforting":
                    seren.src = "/static/seren_comforting.gif";
                    break;
                case "excited":
                    seren.src = "/static/seren_excited.gif";
                    break;
                case "mindful":
                    seren.src = "/static/seren_mindful.gif";
                    break;
                default:
                    seren.src = "/static/seren_calm.gif";
            }
        }
    </script>
</body>
</html>
